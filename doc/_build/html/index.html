

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Welcome to the osm2hydro Documentation &mdash; osm2hydro 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="osm2hydro 0.1 documentation" href="#" />
    <link rel="next" title="Using the tools" href="usage.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="#"><img src="_static/logo.png" border="0" alt="py4sci"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="usage.html" title="Using the tools"
             accesskey="N">next</a> |</li>
        <li><a href="#">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Welcome to the osm2hydro Documentation</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#how-it-works">How it works</a></li>
<li><a class="reference internal" href="#creating-the-paved-area-grids">Creating the paved area grids</a></li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
</ul>
</li>
<li><a class="reference internal" href="#osm2hydro">osm2hydro</a><ul>
</ul>
</li>
<li><a class="reference internal" href="#osm2shp">osm2shp</a><ul>
</ul>
</li>
<li><a class="reference internal" href="#module-map2shape">map2shape</a></li>
<li><a class="reference internal" href="#module-gdal_density">gdal_density</a><ul>
<li><a class="reference internal" href="#module-dem_filter">dem_filter</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
<li><a class="reference internal" href="#todo">TODO</a></li>
</ul>
</li>
</ul>

  <h4>Next topic</h4>
  <p class="topless"><a href="usage.html"
                        title="next chapter">Using the tools</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="welcome-to-the-osm2hydro-documentation">
<h1>Welcome to the osm2hydro Documentation<a class="headerlink" href="#welcome-to-the-osm2hydro-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This document describes osm2hydro. osm2hydro is a set of (python) tools
that can be used to extract information from OpenStreetMap (OSM) and
the Shuttle Radar Topography Mission (SRTM) to
kick-start hydrological and hydraulic modelling.</p>
</div>
<div class="section" id="how-it-works">
<h2>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h2>
<p>First a region of interest is clipped from an OSM file.
From this the tools create shapefiles os selected features (OSM tags) and use
those to create
gridded maps with fraction of paved area, fraction of open water and
fraction of unpaved area in each cell.  The tools are fully configurable
and can be used to generate other maps. They are part of the
Deltares OpenEarth initiative (<a class="reference external" href="https://publicwiki.deltares.nl/display/OET/OpenEarth">https://publicwiki.deltares.nl/display/OET/OpenEarth</a>)
and can be downloaded from goodle code at <a class="reference external" href="http://osm2hydro.googlecode.com">http://osm2hydro.googlecode.com</a>)</p>
<p>Additionally, we created a procedure to use OSM data in the schematisation
of a hydraulic overland flow model. OSM line elements that represent
elevated landscape features are burnt onto an elevation map. We use
the Shuttle Radar Topography Mission 90 meter elevation map
(<a class="reference external" href="http://www2.jpl.nasa.gov/srtm/">http://www2.jpl.nasa.gov/srtm/</a>). Such landscape features are
essential to include in hydraulic overland flow models as
they may block floods and reroute water in other directions.</p>
</div>
<div class="section" id="creating-the-paved-area-grids">
<h2>Creating the paved area grids<a class="headerlink" href="#creating-the-paved-area-grids" title="Permalink to this headline">¶</a></h2>
<p>The methods we have developed to extract land use maps, is divided in
the following steps (see also Figure 1):</p>
<ol class="arabic simple">
<li>Cut-out a specific region (for the model) from the downloaded OSM file
using osmconvert (<a class="reference external" href="http://wiki.openstreetmap.org/wiki/Osmconvert">http://wiki.openstreetmap.org/wiki/Osmconvert</a>),
a standard tool which we use unaltered</li>
<li>Convert the OSM file to a set of shape files using ogr2ogr (from gdal version 1.10)</li>
<li>Convert the shape files to a set of grids (gdal. poly_density, <a class="reference external" href="http://www.gdal.org/">http://www.gdal.org/</a>)</li>
<li>Perform corrections on the grids and shapes and string everything together
(OSM2hydro, <a class="reference external" href="https://publicwiki.deltares.nl/display/OET/OpenEarth">https://publicwiki.deltares.nl/display/OET/OpenEarth</a>)</li>
</ol>
<div class="figure">
<img alt="_images/Fig-1-schematic.png" src="_images/Fig-1-schematic.png" />
</div>
<p>Figure 1 Flow chart of the steps taken to derive land use
(and specifically paved area fraction) maps from OSM</p>
<p>In some areas the different land-use polygons nearly cover the whole area.
As such, the LU polygons can be used to generate the paved, unpaved and
water covered area maps we are aiming to derive. However, in large areas
(also in Western Europe) the coverage is (very) incomplete. For example,
urban areas in and around Liege are hardly covered (see Figure 2). As such we
have taken the following approach to come to a best estimate of paved area in larger areas:</p>
<div class="figure">
<img alt="_images/Fig-3-liege-four.jpg" src="_images/Fig-3-liege-four.jpg" />
</div>
<p>Figure 3 Example of the area around Liege with a particularly poor
OSM coverage.  Paved area determined from Corine (top left),
paved area as estimated from OSM coverage indicating paved land use (top right),
paved land use estimated from road density (bottom left) and a
merger of the two OSM-derived estimates</p>
<p>After the polygons have been extracted from the OSM file the first step is
to generate high resolution grids from the shape files. The high resolution
grids by default have a 10 times higher resolution in both the X and Y
direction. The high resolution grids are then resampled to the final
resolution, thus allowing the determination of fractional coverage in each cell.
For all road classes an estimated width is configured and this is used
to generate a (high resolution) grid in which the width is used to
calculate the fraction covered by roads (assuming the road crossed that
cell in a straight line). At the same time a road-density map is
calculated using the same information but in which all roads have a unit width.
From the density maps and a configurable percentile (default 90%) in the
road density map a map maximum density () and a threshold value ()
for urban areas is determined. These values are then used in a simple
equation (for all cells &gt; ) to estimate the paved area within a cell:</p>
<div class="math">
<p><img src="_images/math/693b7d5672702d71c9447d4109948aa4c2e01fb9.png" alt="paved = min : 1.0, (den^{cell} + f (den^{Max} - den^{TH}))/den^{Max}"/></p>
</div><p>The above equation (where, <img class="math" src="_images/math/bb2c93730dbb48558bb3c4738c956c4e8f816437.png" alt="f"/> a scaling factor is 0.75) basically generates
paved area (houses etc) for all cells that have a road density higher than
the threshold. This map (of paved area fraction) is then merged with the
paved area map that is determined from the polygons in OpenStreetMap.
The merge is done by first applying a multiplication factor to the paved
area determined from the road density and then taking the maximum of the two
maps. The multiplication factor (0.8 in this study) represents the
average paved area fraction in urban areas.
In a third step the resulting map is merged with the maps that holds
the fraction of road cover in the cell by adding the two maps together
while maximising the result to 1.0.</p>
<p>Next two other maps are created, one representing the fraction of
unpaved land use (from polygons that represent “green” areas) and one
representing the fraction of open water. The open water fraction maps
is derived from a combination of waterways in OSM, taking into account
the river width if it is available, and land use classified as water
(the combined water maps are maximized at 1.0).</p>
<p>Generally, the sum of the three maps (paved, unpaved, water) is not 1,
therefore the maps are adjusted using the assumption that the water
fraction map and the roads fraction maps are correct using the following steps:</p>
<p>Add the water fraction and paved area fraction maps and subtract the surplus
(&gt; 1.0) from the paved area map.</p>
<p>If the paved area fraction is not large enough to supply all the surplus
coverage the surplus is subtracted from the unpaved fraction map</p>
<p>If the resulting total cover is larger than 1 it is assumed that the
unpaved polygons are correct and the surplus is subtracted from the paved area
any unassigned area in the resulting maps (total coverage &lt; 1.0) is added to the unpaved fraction map
finally, the road fraction map is used to “burn in” road coverage
over all open water and unpaved area coverage</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Using the tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="usage.html#using-the-command-line-scripts">Using the command-line scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#using-the-tools-from-within-python">Using the tools from within python</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="osm2hydro">
<h2>osm2hydro<a class="headerlink" href="#osm2hydro" title="Permalink to this headline">¶</a></h2>
<p>This is the main script. It needs an .ini file to retrieve it&#8217;s settings
and execute  programs and scripts.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="osm2hydro.html">osm2hydro</a><ul>
<li class="toctree-l2"><a class="reference internal" href="osm2hydro.html#id1">OSM2hydro</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="osm2shp">
<h2>osm2shp<a class="headerlink" href="#osm2shp" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="osm2shp.html">osm2shp</a></li>
</ul>
</div>
</div>
<div class="section" id="module-map2shape">
<span id="map2shape"></span><h2>map2shape<a class="headerlink" href="#module-map2shape" title="Permalink to this headline">¶</a></h2>
<p>This script converts gridded river sections into a shape file. 
Input:</p>
<blockquote>
<div>rivermap:       PCRaster map, containing the river sections as integers
drainmap:       Accumulated drainage map over the pixels, contained in rivermap.__add__</div></blockquote>
<p>Both inputs are produced by a script called &#8216;srtm_burn_process.bat&#8217; (no shell-version available yet)
This script can be run from within srtm_burn_process.bat eventually</p>
<dl class="function">
<dt id="map2shape.convertCoord">
<tt class="descclassname">map2shape.</tt><tt class="descname">convertCoord</tt><big>(</big><em>proj_src</em>, <em>proj_trg</em>, <em>x</em>, <em>y</em><big>)</big><a class="headerlink" href="#map2shape.convertCoord" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a list of x,y pairs in a certain projection to another projection
input:</p>
<blockquote>
<div>proj_src:   string, EPSG or proj4 string referring to projection of source coordinates
proj_trg:   string, EPSG or proj4 string referring to projection of target coordinates
x:          NumPy array, vector or 2D array of x-coordinates (source)
y:          NumPy array, vector or 2D array of y-coordinates (source)</div></blockquote>
<dl class="docutils">
<dt>output:</dt>
<dd>X:          NumPy array, vector or 2D array of x-coordinates (target)
Y:          NumPy array, vector or 2D array of y-coordinates (target)</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="map2shape.readMap">
<tt class="descclassname">map2shape.</tt><tt class="descname">readMap</tt><big>(</big><em>fileName</em>, <em>fileFormat</em><big>)</big><a class="headerlink" href="#map2shape.readMap" title="Permalink to this definition">¶</a></dt>
<dd><p>Read geographical file into memory</p>
</dd></dl>

</div>
<div class="section" id="module-gdal_density">
<span id="gdal-density"></span><h2>gdal_density<a class="headerlink" href="#module-gdal_density" title="Permalink to this headline">¶</a></h2>
<p>Created on Fri Dec  7 15:00:29 2012</p>
<p>Usage:</p>
<div class="highlight-python"><pre>gdal_density -S shapefile -E extent -C cellsize -o outputfile 
             -F outputformat [-r resamplefactor (default = 10)]
             [-b burnvalue (default=1)][-G True|False][-D True|False]
             [-t tempdir][-M]

-G Use gdalwarp instead of pcraster resample (default= False)
-D delete high resolution files after processing (Default=True)
-E [a,b,c,d] following gdal conventions
-t tempdir (to store the high resolution temporary files, default is the current dir
 or the GDAL_DENSITY_TMP environment variable)
-M if specified the burn value is assumed to be given in metres</pre>
</div>
<p>Converts a shape to a grid. The resuling grid holds (for each cell) the 
fraction (0-1) covered by the shapefile. The resamplefactor determines the 
accuracy of the final results. If r is one you get a maps with only zeros and
ones (two possibilities). If r is two you get 5 possible fractions 
(0,0.25,0.5,0.75,1), if r is ten you get a map with 101 possible fractions 
etc...</p>
<p>requirements:</p>
<blockquote>
<div><ul class="simple">
<li>gdal_warp</li>
<li>gdal_rasterize</li>
<li>pcraster 4.0 + python bindings</li>
</ul>
</div></blockquote>
<dl class="function">
<dt id="gdal_density.detDegreeLen">
<tt class="descclassname">gdal_density.</tt><tt class="descname">detDegreeLen</tt><big>(</big><em>metres</em><big>)</big><a class="headerlink" href="#gdal_density.detDegreeLen" title="Permalink to this definition">¶</a></dt>
<dd><p>in length in metres
out length in degree</p>
</dd></dl>

<dl class="function">
<dt id="gdal_density.lattometres">
<tt class="descclassname">gdal_density.</tt><tt class="descname">lattometres</tt><big>(</big><em>lat</em><big>)</big><a class="headerlink" href="#gdal_density.lattometres" title="Permalink to this definition">¶</a></dt>
<dd><p>&#8221;
Determines the length of one degree lat/long at a given latitude (in meter).
Code taken from <a class="reference external" href="http:www.nga.mil/MSISiteContent/StaticFiles/Calculators/degree.html">http:www.nga.mil/MSISiteContent/StaticFiles/Calculators/degree.html</a>
Input: map with lattitude values for each cell
Returns: length of a cell lat, length of a cell long</p>
</dd></dl>

<dl class="function">
<dt id="gdal_density.makeMultMap">
<tt class="descclassname">gdal_density.</tt><tt class="descname">makeMultMap</tt><big>(</big><em>outfile</em>, <em>pcrout</em>, <em>metres</em>, <em>gdal_translate='gdal_translate'</em><big>)</big><a class="headerlink" href="#gdal_density.makeMultMap" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a map in metres to multiply with</p>
</dd></dl>

<div class="section" id="module-dem_filter">
<span id="dem-filter"></span><h3>dem_filter<a class="headerlink" href="#module-dem_filter" title="Permalink to this headline">¶</a></h3>
<p>Created on Wed May 30 16:22:36 2012</p>
<p>&#64;author: Hessel Winsemius</p>
</div>
</div>
<div class="section" id="indices-and-tables">
<h2>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>
<div class="section" id="todo">
<h2>TODO<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="usage.html" title="Using the tools"
             >next</a> |</li>
        <li><a href="#">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Deltares.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>